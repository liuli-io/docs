.. image:: https://raw.githubusercontent.com/howie6879/oss/master/images/uuNLVj.jpg

`Liuli <https://github.com/howie6879/liuli>`_ çš„ç›®çš„æ˜¯ä¸ºäº† **æ„å»ºä¸€ä¸ªå¤šæºã€å¹²å‡€ã€ä¸ªæ€§åŒ–çš„é˜…è¯»ç¯å¢ƒ** ï¼Œä¸€èµ·æ¥çœ‹çœ‹æ€ä¹ˆå®‰è£…éƒ¨ç½² `Liuli <https://github.com/howie6879/liuli>`_ å§ã€‚

--------------
å¼€å§‹
--------------

`Liuli <https://github.com/howie6879/liuli>`_ é¡¹ç›®å¯¹äºä¸€äº›åŸºç¡€ç¯å¢ƒæ˜¯æœ‰ä¸€ç‚¹è¦æ±‚çš„ï¼Œä¸ºäº†å°½å¯èƒ½å‡å°‘å¼€å‘è€…éƒ¨ç½²ä½¿ç”¨çš„å¤æ‚åº¦ï¼ˆç‰¹åˆ«æ˜¯éPythonå¼€å‘è€…ï¼‰ï¼Œå› æ­¤æˆ‘è®¡åˆ’ä½¿ç”¨ ``Docker`` è¿›è¡Œè°ƒåº¦è¿è¡Œï¼Œè¿™æ ·å¯¹ç”¨æˆ·çš„ä½¿ç”¨æ¥è¯´æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹é…Œæƒ…æ‰§è¡Œ ``TODO`` ï¼š

- [ ] å®‰è£… `Docker <https://www.docker.com/>`_
- [ ] é•œåƒå®‰è£…è¿è¡Œï¼šâ¤ï¸ æ¨è

  - [ ] ä¸€é”®å®‰è£…
  - [ ] å•ç‹¬å®‰è£…ï¼ˆå·²æœ‰DBï¼‰
- [ ] ä»£ç å®‰è£… ``Liuli`` ï¼š

  - [ ] ä¸‹è½½ ``Liuli``
  - [ ] é…ç½® ``Liuli``
  - [ ] è¿è¡Œ ``Liuli``

æ¨èç›´æ¥ä½¿ç”¨ ``Docker`` è¿›è¡Œå®‰è£…ï¼Œå¯ä½¿ç”¨ `Docker æé€Ÿä¸‹è½½ <https://get.daocloud.io/>`_ è¿›è¡Œå®‰è£…ã€‚

ä½¿ç”¨åœºæ™¯ï¼š

- [x] å…¬ä¼—å·åº”ç”¨å®è·µï¼š

  - [x] **å¹¿å‘Šé—®é¢˜**ï¼š`æ‰“é€ ä¸€ä¸ªå¹²å‡€ä¸”ä¸ªæ€§åŒ–çš„å…¬ä¼—å·é˜…è¯»ç¯å¢ƒ <https://mp.weixin.qq.com/s/NKnTiLixjB9h8fSd7Gq8lw>`_
  - [x] **RSSè®¢é˜…é—®é¢˜**ï¼š`åŸºäºLiuliæ„å»ºçº¯å‡€çš„RSSå…¬ä¼—å·ä¿¡æ¯æµ <https://mp.weixin.qq.com/s/rxoq97YodwtAdTqKntuwMA>`_
- [ ] ä¿¡æ¯ç›‘æ§
- [ ] æ•°æ®å¤‡ä»½

--------------
é•œåƒå®‰è£…
--------------

ä¸€é”®å®‰è£…:

::

    mkdir liuli && cd liuli
    # æ•°æ®åº“ç›®å½•
    mkdir mongodb_data
    # ä»»åŠ¡é…ç½®ç›®å½•
    mkdir liuli_config
    wget -O liuli_config/default.json https://raw.githubusercontent.com/howie6879/liuli/main/liuli_config/default.json
    # é…ç½® pro.env å…·ä½“æŸ¥çœ‹ ç¯å¢ƒå˜é‡Æ’
    vim pro.env
    # ä¸‹è½½ docker-compose
    wget https://raw.githubusercontent.com/howie6879/liuli/main/docker-compose.yaml
    # å¯åŠ¨
    docker-compose up -d
    # é‡æ–°å¯åŠ¨ liuli_schedule
    docker-compose restart liuli_schedule
    # å…³é—­
    docker-compose down

å¯¹äº ``pro.env`` ç¯å¢ƒå˜é‡é…ç½®ï¼Œå‚è€ƒæ–‡æ¡£è§ï¼š

- `ç¯å¢ƒå˜é‡ <ç¯å¢ƒå˜é‡.html>`_
- `åˆ†å‘å™¨é…ç½® <åˆ†å‘å™¨é…ç½®.html>`_
- `å¤‡ä»½å™¨é…ç½® <å¤‡ä»½å™¨é…ç½®.html>`_

ç„¶ååœ¨å½“å‰ç›®å½• ``liuli_rooot_path`` ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ï¼š::

    docker-compose up -d

    # è¾“å‡º
    # Creating network "liuli_liuli-network" with driver "bridge"
    # Creating liuli_mongodb ... done
    # Creating liuli_api      ... done
    # Creating liuli_schedule ... done

ä¸å‡ºæ„å¤–ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢å®¹å™¨æˆåŠŸå¯åŠ¨ï¼š

.. image:: https://gitee.com/howie6879/oss/raw/master/uPic/rRfTdg.png

**************
å•ç‹¬å®‰è£…
**************

å‡å¦‚ä½ å¸Œæœ›å°† ``Liuli`` çš„å„ä¸ªæ¨¡å—å•ç‹¬å®‰è£…ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹å¼å°±é€‚åˆä½ ã€‚

`Liuli <https://github.com/howie6879/liuli>`_ é¡¹ç›®çš„å­˜å‚¨éƒ¨ç½²ä¾èµ– ``MongoDB`` ï¼Œå¦‚æœä½ å·²ç»éƒ¨ç½²å¥½äº† ``MongoDB`` ï¼Œç›´æ¥åœ¨ **envé…ç½®æ–‡ä»¶** é‡Œé¢è¿›è¡Œæ•°æ®åº“é…ç½®å³å¯ã€‚

å¦‚æœä½ æ²¡æœ‰ ``MongoDB`` ï¼Œå¯ä»¥ä½¿ç”¨ ``Docker`` ä¸€é”®æ‰§è¡Œï¼š::

    # æ•°æ®åº“è·¯å¾„ï¼Œå¼€å‘è€…å¯è‡ªç”±è®¾ç½®
    mkdir -p /data/db
    cd /data/db
    docker run --name liuli_mongodb  --restart=always -p 27017:27017 -v "`pwd`:/data/db" -e MONGO_INITDB_ROOT_USERNAME=liuli -e MONGO_INITDB_ROOT_PASSWORD=liuli -d mongo:3.6

å¯åœ¨ ``Docker`` æŸ¥è¯¢æ˜¯å¦æˆåŠŸå¯åŠ¨ï¼š::

    docker ps -a

    # è¾“å‡º
    # CONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                      NAMES
    # ab5e54de6c4f   mongo:3.6   "docker-entrypoint.sâ€¦"   58 seconds ago   Up 57 seconds   0.0.0.0:27017->27017/tcp   liuli_mongodb

æ¥ä¸‹æ¥å¯åŠ¨ ``liuli_schedule`` ï¼š::

    mkdir liuli

    # é…ç½® pro.env å…·ä½“æŸ¥çœ‹ ç¯å¢ƒå˜é‡
    vim pro.env

    # å¯åŠ¨
    docker run -d -it --restart=always -v $PWD/pro.env:/data/code/pro.env -v $PWD/liuli_config:/data/code/liuli_config --name liuli_schedule liuliio/schedule:v0.2.4

è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š::

    Loading .env environment variables...
    [2021:12:23 23:08:35] INFO  Liuli Schedule started successfully :)
    [2021:12:23 23:08:35] INFO  Liuli Schedule time: 00:00 06:00
    [2021:12:23 23:09:36] INFO  Liuli playwright åŒ¹é…å…¬ä¼—å· è€èƒ¡çš„å‚¨ç‰©æŸœ(howie_locker) æˆåŠŸ! æ­£åœ¨æå–æœ€æ–°æ–‡ç« : æˆ‘çš„å‘¨åˆŠ(ç¬¬018æœŸ)
    [2021:12:23 23:09:39] INFO  Liuli å…¬ä¼—å·æ–‡ç« æŒä¹…åŒ–æˆåŠŸ! ğŸ‘‰ è€èƒ¡çš„å‚¨ç‰©æŸœ
    [2021:12:23 23:09:40] INFO  Liuli ğŸ¤— å¾®ä¿¡å…¬ä¼—å·æ–‡ç« æ›´æ–°å®Œæ¯•(1/1)
    ...
    [2021:12:23 23:09:45] INFO  Liuli å¤‡ä»½å™¨æ‰§è¡Œå®Œæ¯•!

æœ€åå¯åŠ¨ ``liuli_api`` ï¼š::

    # ä¿è¯ pro.env é…ç½®å¥½
    vim pro.env
    # å¯åŠ¨
    docker run -d -it --restart=always -p 8765:8765 -v $PWD/pro.env:/data/code/pro.env --name liuli_api liuliio/api:v0.1.3


**************
ä»£ç å®‰è£…
**************

ä»£ç å®‰è£…æ”¯æŒç³»ç»Ÿå¦‚ä¸‹ï¼š

- Windows
- MacOS
- Linux

å…¶ä»–ç³»ç»Ÿè¯·ä½¿ç”¨ ``Docker`` è¿›è¡Œå®‰è£…ã€‚

==============
ä¸‹è½½Liuli
==============

å®‰è£… `Liuli <https://github.com/howie6879/liuli>`_ å‰ï¼Œéœ€è¦ä½ çš„ç³»ç»Ÿç¯å¢ƒå®‰è£…æœ‰ `Python3.7+ <https://www.python.org/>`_ ç¯å¢ƒã€‚å¦‚æœç¡®è®¤å‡†å¤‡å¥½ç¯å¢ƒï¼Œè¯·è¿›å…¥ç»ˆç«¯ï¼Œåšç¯å¢ƒæ£€æŸ¥ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼š
::

    [~] python --version
    Python 3.7.9 :: Anaconda, Inc.
    [~] pip --version
    pip 20.1 from /Users/howie/.local/share/virtualenvs/liuli-pL4LHJaI/lib/python3.7/site-packages/pip (python 3.7)

æœ¬é¡¹ç›®ä½¿ç”¨ `pipenv <https://pipenv.pypa.io/en/latest/>`_ è¿›è¡Œé¡¹ç›®ç®¡ç†ï¼Œå®‰è£…ä½¿ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š::

    # ç¡®ä¿æœ‰Python3.7+ç¯å¢ƒ
    git clone https://github.com/howie6879/liuli.git
    cd liuli

    # åˆ›å»ºåŸºç¡€ç¯å¢ƒ
    pipenv install --python={your_python3.7+_path}  --skip-lock --dev

æ­å»ºå¥½åŸºç¡€ç¯å¢ƒåï¼Œå°±éœ€è¦å¯¹é¡¹ç›®è¿›è¡Œé…ç½®ï¼Œå…·ä½“å‚è€ƒå¦‚ä¸‹ **Liulié…ç½®** éƒ¨åˆ†ã€‚

==============
é…ç½®Liuli
==============

`Liuli <https://github.com/howie6879/liuli>`_ é¡¹ç›®çš„é…ç½®æ–‡ä»¶ä½äºè·¯å¾„ ``src/config/config.py`` ä¸‹ï¼Œä½¿ç”¨è€…å¯ä»¥è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š

- é…ç½®éœ€è¦è®¢é˜…çš„å…¬ä¼—å·
- æ•°æ®åº“
- åˆ†å‘å™¨ç±»å‹é…ç½®

ç›´æ¥åœ¨ ``.env`` æ–‡ä»¶ä¸­å¢åŠ ç›¸å…³ `ç¯å¢ƒé…ç½® <ç¯å¢ƒå˜é‡.html>`_ å³å¯ï¼š::

    # å…¬ä¼—å·é…ç½®, è¾“å…¥ä½ è®¢é˜…çš„å…¬ä¼—å·åç§°å³å¯
    LL_WECHAT_ACCOUNT="æ˜¯ä¸æ˜¯å¾ˆé…·;è€èƒ¡çš„å‚¨ç‰©æŸœ"

    # æ•°æ®åº“é…ç½®
    # å¦‚æœæ˜¯æœ¬æœºå¼€å‘ï¼Œä½¿ç”¨ä¸Šè¿°æ–¹æ³•æ­å»ºçš„ ``MongoDB`` ï¼Œä»¥ä¸‹å†…å®¹ä¿æŒä¸å˜å³å¯
    LL_M_USER=""
    LL_M_PASS=""
    LL_M_HOST=""
    LL_M_PORT="27017"
    LL_M_DB="liuli"

    # åˆ†å‘å™¨é…ç½®
    # ç›®å‰åˆ†å‘å™¨æ”¯æŒç±»å‹å¦‚ä¸‹ï¼š
    #   - dingï¼šé’‰é’‰
    #   - wecomï¼šä¼ä¸šå¾®ä¿¡
    #   - tg: Telegram
    LL_D_TOKEN=""
    LL_WECOM_ID=""
    LL_WECOM_AGENT_ID="-1"
    LL_WECOM_SECRET=""

å¯¹äºåˆ†å‘å™¨ç›¸å…³å¯¹è±¡çš„å¯†é’¥ç”³è¯·æ•™ç¨‹ï¼Œè¯¦è§ `åˆ†å‘å™¨é…ç½® <åˆ†å‘å™¨é…ç½®.html>`_

==============
è¿è¡ŒLiuli
==============

é…ç½®å®Œæˆåï¼Œç›´æ¥åœ¨ç»ˆç«¯è¿è¡Œå³å¯ï¼š::

    # é…ç½®.env å…·ä½“æŸ¥çœ‹ ç¯å¢ƒå˜é‡
    pipenv run dev_schedule

ä¸å‡ºæ„å¤–ï¼Œä¼šå¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š::

    > pipenv run dev_schedule

    [2021:12:23 22:17:52] INFO  Liuli Schedule started successfully :)
    [2021:12:23 22:17:53] INFO  Liuli Schedule time:
     00:00
     06:00
     09:00
     12:00
     15:00
     18:00
     21:00
    [2021:12:23 22:17:56] INFO  Liuli playwright åŒ¹é…å…¬ä¼—å· æ˜¯ä¸æ˜¯å¾ˆé…·(isnt_it_cool) æˆåŠŸ! æ­£åœ¨æå–æœ€æ–°æ–‡ç« : è½¯ä»¶å·¥ç¨‹å¸ˆå’Œç®—æ³•ç«èµ›
    [2021:12:23 22:17:59] INFO  Liuli å…¬ä¼—å·æ–‡ç« æŒä¹…åŒ–æˆåŠŸ! ğŸ‘‰ æ˜¯ä¸æ˜¯å¾ˆé…·
    [2021:12:23 22:18:02] INFO  Liuli playwright åŒ¹é…å…¬ä¼—å· è€èƒ¡çš„å‚¨ç‰©æŸœ(howie_locker) æˆåŠŸ! æ­£åœ¨æå–æœ€æ–°æ–‡ç« : æˆ‘çš„å‘¨åˆŠ(ç¬¬018æœŸ)
    [2021:12:23 22:18:05] INFO  Liuli å…¬ä¼—å·æ–‡ç« æŒä¹…åŒ–æˆåŠŸ! ğŸ‘‰ è€èƒ¡çš„å‚¨ç‰©æŸœ
    [2021:12:23 22:18:08] INFO  Liuli ğŸ¤— å¾®ä¿¡å…¬ä¼—å·æ–‡ç« æ›´æ–°å®Œæ¯•(2/2)

è¿™æ ·å°±æˆåŠŸå¯åŠ¨äº†ï¼Œå¾®ä¿¡ç»ˆç«¯åˆ†å‘æ•ˆæœå¦‚ä¸‹ï¼š

.. image:: https://raw.githubusercontent.com/howie6879/oss/master/images/m3nJ61.png

..

    `Liuli <https://github.com/howie6879/liuli>`_ é¡¹ç›®è¿˜å¤„äºå¿«é€Ÿè¿­ä»£çš„å¼€å‘çŠ¶æ€ï¼Œæ­¤æ–‡æ¡£éšæ—¶ä¼šå˜åŠ¨ï¼Œåˆ‡è®°ã€‚

    å¦‚æœé˜…è¯»ä½“éªŒä¸å¥½ï¼Œå»ºè®®ç§»æ­¥åšå®¢é˜…è¯» `Liuli ä½¿ç”¨æ•™ç¨‹ <https://www.howie6879.cn/post/2021/11_2c_quick_start/>`_ ã€‚